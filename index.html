<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>00:00:00</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0e12; --card: #12181f; --text: #e2e8f0;
            --text-dim: #64748b; --accent: #00d4ff; --border: #1e293b;
            --bar-bg: rgba(255,255,255,0.03); --danger: #ff4757;
            --police-blue: #1e293b;
        }

        body.light-mode {
            --bg: #f1f5f9; --card: #ffffff; --text: #0f172a;
            --text-dim: #64748b; --accent: #2563eb; --border: #e2e8f0;
            --bar-bg: rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: 0.2s; }

        body {
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #1a232e 0%, var(--bg) 100%);
        }

        /* Top Bar Estilo HUD */
        .hud-bar {
            width: 100%; padding: 12px 30px; background: rgba(18, 24, 31, 0.95);
            border-bottom: 2px solid var(--accent); display: flex;
            justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100;
            backdrop-filter: blur(10px);
        }
        .hud-label { font-size: 10px; font-weight: 900; letter-spacing: 2px; color: var(--accent); }
        .hud-value { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 800; }

        .container { width: 100%; max-width: 800px; padding: 40px 20px; text-align: center; }

        /* T√≠tulo Operacional */
        .op-header { margin-bottom: 30px; border-left: 4px solid var(--accent); padding-left: 15px; display: inline-block; }
        .op-title { font-weight: 900; font-size: 14px; letter-spacing: 5px; text-transform: uppercase; margin: 0; }

        /* Cron√¥metro Central - Ajustado */
        .main-timer-card {
            background: var(--card); border: 1px solid var(--border);
            padding: 40px; border-radius: 4px; /* Estilo mais angular/policial */
            width: 100%; max-width: 500px; margin: 0 auto 40px auto;
            position: relative; clip-path: polygon(0 0, 95% 0, 100% 15%, 100% 100%, 5% 100%, 0 85%);
        }
        #display { 
            font-family: 'JetBrains Mono', monospace; font-size: 72px; font-weight: 800; 
            color: var(--accent); text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        #current-mission { font-size: 10px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 3px; }

        /* Inputs de Miss√£o */
        .add-box { 
            background: var(--card); padding: 20px; border: 1px solid var(--border);
            display: grid; grid-template-columns: 1fr 140px 50px; gap: 10px; margin-bottom: 30px;
        }
        input { 
            background: #000; border: 1px solid var(--border); padding: 12px; 
            border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; outline: none;
        }
        input::placeholder { color: #334155; }

        /* Grid de Disciplinas */
        .mission-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; width: 100%; }
        
        .mission-card {
            background: var(--card); border: 1px solid var(--border); padding: 20px;
            text-align: left; position: relative; cursor: pointer; border-left: 3px solid transparent;
        }
        .mission-card.active { border-left-color: var(--accent); background: rgba(0, 212, 255, 0.05); }
        .mission-card.completed { opacity: 0.4; border-left-color: #475569; }

        .progress-track { height: 4px; background: #000; margin: 15px 0; border-radius: 2px; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; box-shadow: 0 0 10px var(--accent); }

        /* Modais Operacionais */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-card {
            background: var(--card); border: 2px solid var(--accent);
            padding: 30px; width: 90%; max-width: 380px; text-align: center;
        }

        .btn-op {
            padding: 12px; border: 1px solid var(--border); background: var(--card);
            color: var(--text); cursor: pointer; font-weight: 800; font-size: 12px; text-transform: uppercase;
        }
        .btn-op.primary { background: var(--accent); color: #000; border: none; }

        .fab-dock { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 10px; }
        .fab { width: 48px; height: 48px; border-radius: 4px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; }

        @media (max-width: 600px) {
            .add-box { grid-template-columns: 1fr; }
            #display { font-size: 50px; }
        }
    </style>
</head>
<body>

    <div id="modal" class="modal-overlay">
        <div class="modal-card">
            <div id="modal-title" style="font-weight: 900; color: var(--accent); margin-bottom: 15px;">CONFIRMA√á√ÉO</div>
            <p id="modal-text" style="font-size: 13px; color: var(--text-dim); margin-bottom: 25px;"></p>
            <div style="display: flex; gap: 10px;">
                <button class="btn-op" style="flex: 1;" onclick="closeModal()">ABORTAR</button>
                <button id="modal-confirm-btn" class="btn-op primary" style="flex: 1;">EXECUTAR</button>
            </div>
        </div>
    </div>

    <div class="hud-bar">
        <div>
            <div class="hud-label">STATUS_L√çQUIDO</div>
            <div class="hud-value" id="total-net">00:00:00</div>
        </div>
        <div id="op-tag" style="color: var(--accent); font-weight: 900; font-size: 11px;">[ STANDBY ]</div>
    </div>

    <div class="container">
        <div class="op-header">
            <h1 class="op-title">Di√°rio de Bordo <span>v2.0</span></h1>
        </div>

        <div class="main-timer-card">
            <span id="current-mission">Nenhuma Unidade Ativa</span>
            <div id="display">00:00:00</div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn-op" onclick="confirmReset()">‚ü≤</button>
                <button class="btn-op primary" onclick="start()">INICIAR</button>
                <button class="btn-op" onclick="pause()">PAUSAR</button>
            </div>
        </div>

        <div class="add-box">
            <input type="text" id="task-name" placeholder="DISCIPLINA / MISS√ÉO">
            <input type="text" id="task-time" placeholder="00:00:00" maxlength="8">
            <button class="btn-op primary" onclick="createTask()">+</button>
        </div>

        <div id="task-list" class="mission-grid"></div>
    </div>

    <div class="fab-dock">
        <button class="fab" style="background: var(--danger);" onclick="confirmClearAll()">üóëÔ∏è</button>
        <button class="fab" style="background: var(--accent);" onclick="toggleTheme()" id="theme-btn">‚òÄÔ∏è</button>
    </div>

    <script>
        let timer, seconds = 0, activeTaskId = null, tasks = JSON.parse(localStorage.getItem('study_tasks')) || [];

        // M√°scara HH:MM:SS
        document.getElementById('task-time').addEventListener('input', e => {
            let v = e.target.value.replace(/\D/g, '');
            if (v.length > 4) v = v.substring(0,2) + ':' + v.substring(2,4) + ':' + v.substring(4,6);
            else if (v.length > 2) v = v.substring(0,2) + ':' + v.substring(2,4);
            e.target.value = v;
        });

        function openModal(title, text, onConfirm) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            const btn = document.getElementById('modal-confirm-btn');
            btn.onclick = () => { onConfirm(); closeModal(); };
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            document.getElementById('theme-btn').innerText = isLight ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }
        if(localStorage.getItem('theme') === 'light') toggleTheme();

        function formatTime(s) {
            const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }

        function save() { 
            localStorage.setItem('study_tasks', JSON.stringify(tasks)); 
            document.getElementById('total-net').innerText = formatTime(tasks.reduce((acc, t) => acc + t.elapsedSeconds, 0));
        }

        function createTask() {
            const name = document.getElementById('task-name').value, timeStr = document.getElementById('task-time').value;
            if (!name || !timeStr) return;
            const parts = timeStr.split(':').map(Number);
            let total = 0;
            if (parts.length === 3) total = (parts[0]*3600) + (parts[1]*60) + parts[2];
            else if (parts.length === 2) total = (parts[0]*3600) + (parts[1]*60);
            
            tasks.push({ id: Date.now(), name, goalSeconds: total, elapsedSeconds: 0, completed: false });
            document.getElementById('task-name').value = ''; document.getElementById('task-time').value = '';
            save(); renderTasks();
        }

        function selectTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task.completed) return;
            if (timer) pause();
            activeTaskId = id; seconds = task.elapsedSeconds;
            document.getElementById('current-mission').innerText = "UNIDADE: " + task.name;
            document.getElementById('op-tag').innerText = "[ EM OPERA√á√ÉO ]";
            updateDisplay(); renderTasks();
        }

        function updateDisplay() {
            const t = formatTime(seconds);
            document.getElementById('display').innerText = t;
            document.title = t;
            if (activeTaskId) {
                const task = tasks.find(t => t.id === activeTaskId);
                task.elapsedSeconds = seconds;
                save();
                const fill = document.getElementById(`fill-${activeTaskId}`);
                if(fill) fill.style.width = Math.min((task.elapsedSeconds / task.goalSeconds) * 100, 100) + '%';
            }
        }

        function start() { if (activeTaskId && !timer) timer = setInterval(() => { seconds++; updateDisplay(); }, 1000); }
        function pause() { clearInterval(timer); timer = null; document.getElementById('op-tag').innerText = "[ PAUSADO ]"; }

        function confirmReset() {
            if (!activeTaskId) return;
            openModal("REINICIAR UNIDADE", "Zerar cron√¥metro da miss√£o atual?", () => {
                pause(); seconds = 0; updateDisplay(); renderTasks();
            });
        }

        function confirmClearAll() {
            openModal("REDA√á√ÉO FINAL", "Apagar todos os dados operacionais do dia?", () => {
                pause(); tasks = []; activeTaskId = null; seconds = 0;
                localStorage.removeItem('study_tasks');
                document.title = "00:00:00"; renderTasks();
            });
        }

        function toggleComplete(e, id) {
            e.stopPropagation();
            const task = tasks.find(t => t.id === id);
            task.completed = !task.completed;
            if (task.completed && activeTaskId === id) { pause(); activeTaskId = null; document.getElementById('display').innerText = "00:00:00"; }
            save(); renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            [...tasks].sort((a,b) => a.completed - b.completed).forEach(task => {
                const perc = Math.min((task.elapsedSeconds / task.goalSeconds) * 100, 100).toFixed(0);
                list.innerHTML += `
                    <div class="mission-card ${task.id === activeTaskId ? 'active' : ''} ${task.completed ? 'completed' : ''}" onclick="selectTask(${task.id})">
                        <div style="display:flex; justify-content:space-between;">
                            <strong style="font-size: 13px;">${task.name.toUpperCase()}</strong>
                            <input type="checkbox" ${task.completed ? 'checked' : ''} onclick="toggleComplete(event, ${task.id})">
                        </div>
                        <div class="progress-track"><div id="fill-${task.id}" class="progress-fill" style="width:${perc}%"></div></div>
                        <div style="display:flex; justify-content:space-between; font-size:9px; font-weight:800; color:var(--text-dim);">
                            <span>OBJ: ${formatTime(task.goalSeconds)}</span>
                            <span>LIQ: ${formatTime(task.elapsedSeconds)}</span>
                        </div>
                    </div>`;
            });
            save();
        }
        renderTasks();
    </script>
</body>
</html>
